!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r={findFn:function(e,t){return Array.prototype.find.call(e,t)},throttle:function(e,t,n){var r=Date.now();return function(){var i=n||this,a=arguments,o=Date.now();o-r>t&&(r=o,e.apply(i,a))}}};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={}}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this.events[e];Array.isArray(i)&&i.forEach((function(e){e.apply(null,n)}))}},{key:"off",value:function(){this.events={}}}])&&i(t.prototype,n),r&&i(t,r),e}();var o=observe;function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l={text:"",rootEl:document.body,canvasId:"sis023ksd",lineHeight:30,fillStyle:"rgba(1, 1, 1, 0.015)",watermarkWidth:100,watermarkHeight:50,rotate:-20,xGap:50,yGap:50},c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.delegateEvents=["click","dblclick","mouseup","mousedown"],this.canvasEl=null,this.event=t,this.supportPointerEvents=this.getSupportPointerEvents()}var t,n,r;return t=e,(n=[{key:"render",value:function(e){var t=this;this.remove(),Object.assign(this,l,e),this.genCanvas(),setTimeout((function(){t.rootEl.appendChild(t.canvasEl),t.supportPointerEvents||t.delegatePointerEvents(),t.event.trigger("render",t.rootEl,t.canvasEl)}),0)}},{key:"genCanvas",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=window,r=n.innerWidth,i=n.innerHeight;e.id=this.canvasId,e.width=r,e.height=i,e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",e.style.zIndex=99999,t.font="16px",t.fillStyle=this.fillStyle,t.textBaseline="hanging";var a=parseInt(Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));t.translate((r-a)/2,(i-a)/2),t.translate(.5*a,.5*a),t.rotate(this.rotate*Math.PI/180),t.translate(.5*-a,.5*-a);for(var o=Math.ceil(a/(this.watermarkWidth+this.xGap)),s=Math.ceil(a/(this.watermarkHeight+this.yGap)),l=0;l<o;l++)for(var c=0;c<s;c++)this.fillTextWrap(t,this.text,parseInt(a/o*l),parseInt(a/s*c),this.lineHeight,this.watermarkWidth);this.canvasEl=e}},{key:"delegatePointerEvents",value:function(){var e=this,t=this.canvasEl;this.handler=function(n){e.event.trigger("pauseObserve"),t.style.display="none";var r,i=document.elementFromPoint(n.clientX,n.clientY);(r=document.createEvent("MouseEvents")).initMouseEvent(n.type,!0,!0,window,0,n.screenX,n.screenY,n.clientX,n.clientY,0,0,0,0,0,null),i.dispatchEvent(r);var a=e.getEditNode(i);if(a&&"click"===n.type){var o=n.clientX,s=n.clientY;if("INPUT"===i.nodeName){i.focus();var l=i.createTextRange(),c=l.text.length,u=i.scrollLeft;l.collapse(!0);var v=0;!function e(){if(!(++v>c)){l.expand("character");var t=l.boundingLeft,n=l.boundingTop,r=l.boundingWidth,a=l.boundingHeight,f=t+u;f<=o&&o<=f+r&&n<=s&&s<=n+a?i.setSelectionRange(v,v):(l.collapse(!1),e())}}()}else try{var f=document.body.createTextRange();f.moveToPoint(o,s),f.expand("character"),f.collapse(!0),f.select(),i.focus()}catch(e){i.focus();var h=a.innerHTML;a.innerHTML=h}}return t.style.display="block",e.event.trigger("recoverObserve"),n.stopPropagation(),n.preventDefault(),!1},this.delegateEvents.forEach((function(n){t.addEventListener(n,e.handler)}))}},{key:"getEditNode",value:function(e){if(["INPUT","TEXTAREA"].includes(e.nodeName))return e;if("true"===e.getAttribute("contenteditable"))return e;var t=document.querySelectorAll("[contenteditable=true]"),n=findFn(t,(function(t){return t.contains(e)}));return n||null}},{key:"fillTextWrap",value:function(e,t,n,r,i,a){var o=t.split(""),s=[],l="";o.forEach((function(t){e.measureText(l+t).width<a?l+=t:(s.push(l),l=t)})),l&&s.push(l),s.forEach((function(t,a){var o=r+a*i;e.fillText(t,n,o)}))}},{key:"remove",value:function(){this.removeListener();var e=document.querySelector("#".concat(this.canvasId));e&&e.parentNode.removeChild(e)}},{key:"removeListener",value:function(){var e=this;this.canvasEl&&!this.supportPointerEvents&&this.delegateEvents.forEach((function(t){e.canvasEl.removeEventListener(t,e.handler)}))}},{key:"getSupportPointerEvents",value:function(){return!("Microsoft Internet Explorer"==navigator.appName&&null!=navigator.userAgent.match(/MSIE ([0-9]{1,}[.0-9]{0,})/)&&parseFloat(RegExp.$1)<11)}}])&&s(t.prototype,n),r&&s(t,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.event=new a,this.observe=new o(this.event),this.canvas=new c(this.event),this.handlerResize=r.throttle((function(){t.clear(),t.init(t.option)}),200,{leading:!0})}var t,n,i;return t=e,(n=[{key:"init",value:function(e){var t=this;this.clear(),this.option=e,this.canvas.render(e),this.event.on("render",(function(e,n){t.observe.add(e,n)})),this.event.on("nodeChanged",(function(){t.init(e)})),window.addEventListener("resize",this.handlerResize)}},{key:"clear",value:function(){this.event.off(),this.observe.remove(),this.canvas.remove(),window.removeEventListener("resize",this.handlerResize)}}])&&u(t.prototype,n),i&&u(t,i),e}();t.default=v}]);